<a name="sec7"></a>

## 7 Session 管理
<!-- ## 7 Session Management -->

*This section is normative.*

一度 Authentication イベントが行われると，Subscriber が複数のインタラクションをまたぐアプリケーションを Authentication イベントを繰り返す必要なく継続して使用し続けられることはしばしば望まれる． この要件は， Authentication イベントがネットワーク経由で調整したいくつかのコンポーネントやパーティを巻き込む Federation シナリオ ( [SP 800-63C](sp800-63c.html) で説明される) に特に当てはまる．

<!-- Once an authentication event has taken place, it is often desirable to allow the subscriber to continue using the application across multiple subsequent interactions without requiring them to repeat the authentication event. This requirement is particularly true for federation scenarios — described in [SP 800-63C](sp800-63c.html) — where the authentication event necessarily involves several components and parties coordinating across a network. -->

この振る舞いを容易にするため，* Session * は，ある Authentication イベントへの応答によって開始されてもよい (MAY) ．そしてその Session はそれが終了されるときまで維持される． Session は，活動がないときのタイムアウト，明示的なログアウトイベント，その他の理由など，様々な理由により終了されることがある (MAY) ． Session は， Reauthentication イベント ( [Section 7.2](#sessionreauthn) で説明される ) を通して維持されてもよい (MAY) ．ユーザーは，初回の Authentication イベントの一部または全部を繰り返すことによってセッションを再確立する．

<!-- To facilitate this behavior, a *session* MAY be started in response to an authentication event, and continue the session until such time that it is terminated. The session MAY be terminated for any number of reasons, including but not limited to an inactivity timeout, an explicit logout event, or other means. The session MAY be continued through a reauthentication event — described in [Section 7.2](#sessionreauthn) — wherein the user repeats some or all of the initial authentication event, thereby re-establishing the session. -->

Session 管理は 頻繁な Credential の提示よりも望ましい． Credential を頻繁に提示することのユーザビリティの低さは，しばしばロック解除用 Credential のキャッシュなどの回避策に対するインセンティブを生み出し， Authentication イベントの新鮮さを無効にする．

<!-- Session management is preferable over continual presentation of credentials as the poor usability of continual presentation often creates incentives for workarounds such as cached unlocking credentials, negating the freshness of the authentication event. -->

### 7.1 Session Bindings

Session は， Subscriber が動作しているソフトウェア &mdash; ブラウザー，アプリケーション，オペレーティング システム (つまり Session Subject) &mdash; と， Subscriber がアクセスする RP や CSP (つまり Session ホスト) の間に発生する． Session シークレットは， Subscriber のソフトウェアとアクセスされているサービスの間で共有されることとする (SHALL) ． このシークレットは，Session の 2 つのエンドをバインドし， Subscriber が経時的にサービスを使用し続けることを許可する． シークレットは，Subscriber のソフトウェアによって直接提示されることとする (SHALL) ．または，シークレットの所有は暗号化メカニズムによって証明されることとする (SHALL) ．

<!-- A session occurs between the software that a subscriber is running &mdash; such as a browser, application, or operating system (i.e., the session subject) &mdash; and the RP or CSP that the subscriber is accessing (i.e., the session host). A session secret SHALL be shared between the subscriber's software and the service being accessed. This secret binds the two ends of the session, allowing the subscriber to continue using the service over time. The secret SHALL be presented directly by the subscriber's software or possession of the secret SHALL be proven using a cryptographic mechanism. -->

Session のバインドに使用されるシークレットは， Session ホストによって Authentication イベントへの直接の応答の中で生成されることとする (SHALL) ． Session はその生成がトリガーされた Authentication イベントの AAL プロパティ 継承するべきである (SHOULD) ． Session は Authentication イベントよりも低い AAL で考えられてもよい (MAY) が， Authentication イベントよりも高い AAL では考えないこととする (SHALL NOT) ．

<!-- The secret used for session binding SHALL be generated by the session host in direct response to an authentication event. A session SHOULD inherit the AAL properties of the authentication event which triggered its creation. A session MAY be considered at a lower AAL than the authentication event but SHALL NOT be considered at a higher AAL than the authentication event. -->

Session Binding に使用されるシークレットは :
<!-- Secrets used for session binding: -->

1. インタラクションの間に，通常は Authentication の直後に Session ホストによって生成されることとする (SHALL) ．
2. 承認されたランダムビットジェネレーター [[SP 800-90Ar1]](#SP800-90Ar1) によって生成され，少なくとも64ビットの Entropy を含むこととする (SHALL) ．
3. Subscriber のログアウト時に， Session Subject によって消去または無効にされることとする (SHALL) ．
4. ユーザーがログアウトするとき，またはシークレットの期限が切れたとみなされるとき，Subscriber エンドポイントから消去されるべきである (SHOULD) ．
5. Cross-site Scripting (XSS) 攻撃によるローカルストレージ暴露の可能性があるため，HTML5 ローカル ストレージなどの安全でない場所に配置されるべきでない (SHOULD NOT) ．
6. Authenticated Protected Channel を使用してデバイスから送信，または受信されることとする (SHALL) ．
7. [Section 4.1.4](#aal1reauth)，[4.2.4](#aal2reauth)，[4.3.4](#aal3reauth) の AAL にふさわしい時間の後は，タイムアウトすることとし，受け付けられてはならないこととする (SHALL) ．
8. ホストと Subscriber のエンドポイント間の安全でないコミュニケーションでは有効にしないこととする (SHALL NOT) ． Authenticated Session は，Authentication の後，HTTPSからHTTPへというような安全でないトランスポートにフォールバックしないこととする (SHALL NOT) ．

<!-- 1. SHALL be generated by the session host during an interaction, typically immediately following authentication.
2. SHALL be generated by an approved random bit generator [[SP 800-90Ar1]](#SP800-90Ar1) and contain at least 64 bits of entropy.
3. SHALL be erased or invalidated by the session subject when the subscriber logs out.
4. SHOULD be erased on the subscriber endpoint when the user logs out or when the secret is deemed to have expired.
5. SHOULD NOT be placed in insecure locations such as HTML5 Local Storage due to the potential exposure of local storage to cross-site scripting (XSS) attacks.
6. SHALL be sent to and received from the device using an authenticated protected channel.
7. SHALL time out and not be accepted after the times specified in [Sections 4.1.4](#aal1reauth), [4.2.4](#aal2reauth), and [4.3.4](#aal3reauth), as appropriate for the AAL.
8. SHALL NOT be available to insecure communications between the host and subscriber's endpoint. Authenticated sessions SHALL NOT fall back to an insecure transport, such as from https to http, following authentication. -->

URL か POST 内容は Session identifier を含むこととする (SHALL) ．Session identifier は， Session の外側で行われたアクションが Protected Session に影響しないことを保証することを RP によって検証されることとする (SHALL) ．

<!-- URLs or POST content SHALL contain a session identifier that SHALL be verified by the RP to ensure that actions taken outside the session do not affect the protected session. -->

経時的に Session を管理するためにはいくつかのメカニズムがある． 次のセクションでは，各例のテクノロジー特有の追加要件と考慮事項に沿って，それぞれの例を示す． 追加の有用なガイダンスとして， OWASP *Session Management Cheat Sheet* [[OWASP-session]](#OWASP-session) がある．

<!-- There are several mechanisms for managing a session over time. The following sections give different examples along with additional requirements and considerations particular to each example technology. Additional informative guidance is available in the OWASP *Session Management Cheat Sheet* [[OWASP-session]](#OWASP-session). -->

#### 7.1.1. ブラウザー クッキー
<!-- #### 7.1.1 Browser Cookies -->

ブラウザー クッキーは，サービスにアクセスする Subscriber のための Session の作成と追跡において，有力なメカニズムである．

<!-- Browser cookies are the predominant mechanism by which a session will be created and tracked for a subscriber accessing a service. -->

クッキーは :

<!-- Cookies: -->

1. セキュアな (HTTPS) Session のみでアクセス可能なようにタグ付けされることとする (SHALL) ．
2. ホスト名とパスの最小で実際的なセットにアクセス可能であることとする (SHALL) ．
3. JavaScript (HttpOnly) からアクセス不可となるようにタグ付けされるべきである (SHOULD) ．
4. Sessionの有効な期間，またそのすぐ後に有効期限切れとなるようタグ付けされるべきである (SHOULD) ． この要件はクッキーの蓄積を制限することを目的としているが，強制的な Session タイムアウトへの依存はしないこととする (SHALL NOT) ．

<!-- 1. SHALL be tagged to be accessible only on secure (HTTPS) sessions.
2. SHALL be accessible to the minimum practical set of hostnames and paths.
3. SHOULD be tagged to be inaccessible via JavaScript (HttpOnly).
4. SHOULD be tagged to expire at, or soon after, the session's validity period. This requirement is intended to limit the accumulation of cookies, but SHALL NOT be depended upon to enforce session timeouts. -->

#### 7.1.2 Access Tokens
<!-- #### 7.1.2 Access Tokens -->

Access Token — OAuth に見られるような — はアプリケーションが Authentication イベントの後，Subscriber のために一連のサービスに Access することを許可するために使用される． OAuth Access Token の存在は，他のシグナルがない場合，RP によって Subscriber の存在として解釈されないこととする (SHALL NOT) ． OAuth Access Token ，および関連付けられた Refresh Token は，Authentication Session が終了され，Subscriber そのアプリケーションから去ったあとでも，有効であってもよい (MAY) ．

<!-- An access token — such as found in OAuth — is used to allow an application to access a set of services on a subscriber's behalf following an authentication event. The presence of an OAuth access token SHALL NOT be interpreted by the RP as presence of the subscriber, in the absence of other signals. The OAuth access token, and any associated refresh tokens, MAY be valid long after the authentication session has ended and the subscriber has left the application. -->

#### 7.1.3 デバイスの識別
<!-- #### 7.1.3 Device Identification -->

Subscriber とサービス間の Session の制定には，安全なデバイス識別の他の方法 &mdash; 相互 TLS や Token Binding ，その他のメカニズムを含み，これに限らない &mdash; が使用されてもよい (MAY) ．

<!-- Other methods of secure device identification &mdash; including but not limited to mutual TLS, token binding, or other mechanisms &mdash; MAY be used to enact a session between a subscriber and a service. -->

### 7.2 <a name="sessionreauthn"></a>Reauthentication
<!-- ### 7.2 <a name="sessionreauthn"></a>Reauthentication -->

認証された Session の継続性は，Authentication の際に Verifier によって発行され，セッション中に任意に更新される Session シークレット の所有に基づくすることとする (SHALL) ． Session の性質は以下を含むアプリケーションに依存する :

<!-- Continuity of authenticated sessions SHALL be based upon the possession of a session secret issued by the verifier at the time of authentication and optionally refreshed during the session. The nature of a session depends on the application, including: -->

1. Web ブラウザー Session と "Session" クッキー
2. Session シークレットを保持するモバイルアプリケーションのインスタンス

<!-- 1. A web browser session with a "session" cookie, or
2. An instance of a mobile application that retains a session secret. -->

Session シークレットは非永続的であることとする (SHALL) ．つまり，関連するアプリケーションのリスタートやホストデバイスのリブートを超えて残置されないこととする (SHALL NOT) ．

<!-- Session secrets SHALL be non-persistent. That is, they SHALL NOT be retained across a restart of the associated application or a reboot of the host device. -->

Session の 定期的な Reauthentication は，認証された Session において，Subscriber が継続して存在していること (すなわち Subscriber がログアウトせずに立ち去っていないこと) を確認するために実行されることとする (SHALL) ．

<!-- Periodic reauthentication of sessions SHALL be performed to confirm the continued presence of the subscriber at an authenticated session (i.e., that the subscriber has not walked away without logging out). -->

Session は，Session シークレット単独の提示に基づいて，セクション [4.1.3](#aal1reauth), [4.2.3](#aal2reauth) そして [4.3.3](#aal3reauth) (AALに応じる) のガイドラインを超えて拡張されないこととする (SHALL NOT) ． Reauthentication のタイムリミットは，Session が 満了する前に，[表 7-1](#63bSec7-Table1)で指定された Authentication Factor を Subscriber に促すことで延長されることとする (SHALL) ．

<!-- A session SHALL NOT be extended past the guidelines in Sections [4.1.3](#aal1reauth), [4.2.3](#aal2reauth), and [4.3.3](#aal3reauth) (depending on AAL) based on presentation of the session secret alone. Prior to session expiration, the reauthentication time limit SHALL be extended by prompting the subscriber for the authentication factor(s) specified in [Table 7-1](#63bSec7-Table1). -->

タイムアウトやその他のアクションによって Session が終了されたとき，ユーザーは再度の Authenticate によって新しい Session の確立を要求されることとする (SHALL) ．

<!-- When a session has been terminated, due to a time-out or other action, the user SHALL be required to establish a new session by authenticating again. -->

<a name="63bSec7-Table1"></a>

<div class="text-center">

**表 7-1 AAL Reauthentication 要件**
<!-- **Table 7-1 AAL Reauthentication Requirements** -->

</div>

| AAL | 要件                                  |
| --- | ----------------------------------- |
| 1   | 任意の 1 つのファクターの提示                    |
| 2   | Memorized Secret または Biometrics の提示 |
| 3   | 全てのファクターの提示                         |

<!-- |AAL|Requirement|
|----|----|
|1|Presentation of any one factor|
|2|Presentation of a memorized secret or biometric|
|3|Presentation of all factors| -->

> ノート: AAL2では，Session シークレットは *something you have* であり，また追加の Authentication Factor が Session を継続するために要求されるため， 物理的な Authenticator でない，Memorized Secret または Biometrics が必須とされる．

<!-- >Note: At AAL2, a memorized secret or biometric, and not a physical authenticator, is required because the session secret is *something you have*, and an additional authentication factor is required to continue the session. -->

#### 7.2.1 Federation または Assertion からの Reauthentication
<!-- #### 7.2.1 Reauthentication from a Federation or Assertion -->

CSP と RP を接続するために [SP 800-63C](sp800-63c.html) のセクション5で説明されている Federation プロトコルを使用するとき，Session 管理と Reauthentication は特別な考慮事項が適用される． Federation プロトコルは CSP と RP の間の Authentication イベントを執り行うが，それらの間に Session を確立しない． CSP と RP は，しばしば別々の Session 管理技術を採用しているので，これらのセッション間にはどんな相関も仮定しないこととする (SHALL NOT) ． したがって，RP の Session が満了し RP が再認証を必要とするとき，CSP の Session が満了しておらず，ユーザーの Reauthentication なしに CSP でこの Session から新しい Assertion が生成される可能性は十分にある．

<!-- When using a federation protocol as described in [SP 800-63C](sp800-63c.html), Section 5 to connect the CSP and RP, special considerations apply to session management and reauthentication. The federation protocol communicates an authentication event between the CSP and the RP but establishes no session between them. Since the CSP and RP often employ separate session management technologies, there SHALL NOT be any assumption of correlation between these sessions. Consequently, when an RP session expires and the RP requires reauthentication, it is entirely possible that the session at the CSP has not expired and that a new assertion could be generated from this session at the CSP without reauthenticating the user. -->

Federation プロトコルによる Reauthentication を必要とする RP は，— 可能な場合はプロトコル内で — CSPへの許容可能な最大の Authentication 経過時間を指定することとし (SHALL)，その期間内に Authentication が行われていない場合，CSP は Subscriber を Reauthentication することとする (SHALL) ． CSP は，RP が，Assertion が Reauthentication に十分かを決定でき且つ次の Reauthentication イベントの時間を決定するために， Authentication イベントの時間を RP へ伝えることとする (SHALL) ．

<!-- An RP requiring reauthentication through a federation protocol SHALL — if possible within the protocol — specify the maximum acceptable authentication age to the CSP, and the CSP SHALL reauthenticate the subscriber if they have not been authenticated within that time period. The CSP SHALL communicate the authentication event time to the RP to allow the RP to decide if the assertion is sufficient for reauthentication and to determine the time for the next reauthentication event. -->
